# Terraform AWS Modules

Infrastructure as Code building blocks for common AWS services such as CloudTrail, GuardDuty, Cognito, Datadog, and Terraform state management. Each directory contains an independently reusable Terraform module with its own variables, outputs, and example configurations.

## Provenance

These modules were copied from [https://gitlab.com/open-source-devex/terraform-modules/aws](https://gitlab.com/open-source-devex/terraform-modules/aws) so they can live under the GRESB GitHub organisation and remain under GRESB control. Maintaining this fork makes it easier to pin revisions, contribute changes, and integrate the code into internal workflows while tracking any local customisations.

## Available modules

| Module | Summary |
| --- | --- |
| [cloud-trail](./cloud-trail) | Configures AWS CloudTrail with S3, CloudWatch Logs, SNS, and optional KMS/Object Lock support for centralized auditing. |
| [cognito-user-pool](./cognito-user-pool) | Provisions Amazon Cognito user pools, hosted UI domains, Lambda triggers, and app clients with a consistent tagging model. |
| [config-managed-rules](./config-managed-rules) | Enables AWS Config recorders, delivery channels, and a curated set of managed rules with optional multi-account aggregation and log buckets. |
| [datadog-integration](./datadog-integration) | Creates the AWS ↔︎ Datadog integration, including log forwarder CloudFormation stacks and the RDS enhanced metrics subscription. |
| [ecr-repository](./ecr-repository) | Creates an Amazon ECR repository with lifecycle policies, optional KMS encryption, scan-on-push, and repository policies for read-only/full-access principals. |
| [guard-duty](./guard-duty) | Enables AWS GuardDuty detectors, monitors multiple regions/accounts, and lets you wire custom destinations (S3, SNS, or CWL) instead of the module creating them. |
| [kms-key](./kms-key) | Manages KMS keys, aliases, rotation, deletion windows, and flexible IAM policies built from structured input. |
| [terraform-state-backend](./terraform-state-backend) | Creates an S3 bucket, DynamoDB lock table, and KMS key to host remote Terraform state with optional access policies per user or role. |
| [tls-certificate](./tls-certificate) | Requests ACM certificates validated through Route 53 DNS records, including cross-account/region issuance via aliased providers. |

Every module directory ships with autogenerated Terraform docs and one or more `examples/` folders that show real-world usage patterns (the IDE context defaults to `examples/*/test-main.tf` files for convenience).

## Quick start

1. Choose the module folder that matches the AWS capability you need.
2. Review its `README.md`, `versions.tf`, and `examples/` to understand required providers and inputs.
3. Reference the module from your configuration, pinning to a commit, tag, or branch.
4. Run `terraform init`, `terraform validate`, and `terraform plan` before applying.

```hcl
terraform {
  required_version = "~> 1.13"
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = ">= 6.0"
    }
  }
}

module "cloudtrail" {
  # Replace URL/ref with the location of this repository in your organisation.
  source = "git::https://github.com/your-org/terraform-modules.git//cloud-trail?ref=main"

  project     = "compliance"
  environment = "prod"

  bucket_name = "my-cloudtrail-logs"
  enable_kms  = true
  tags        = { managed_by = "terraform" }
}
```

When this repository is checked out inside a mono-repo, you can also use a relative `source = "../terraform-modules/cloud-trail"` to avoid relying on Git URLs.

## Working with examples

Each module contains Terraform configurations under `examples/`. They are designed so you can run:

```sh
cd MODULE/examples/SCENARIO
terraform init
terraform plan
```

Examples double as smoke tests—update them whenever you introduce new variables or outputs to keep the documentation accurate.

## Contributing

- Keep changes scoped to a single module whenever possible.
- Run `terraform fmt -recursive` and `terraform validate` (optionally against the example configurations) before opening a pull request.
- Document behaviour changes in both the module-level README and, if relevant, this repository overview.
- When syncing from the upstream GitLab project, prefer pulling individual directories so unrelated local adjustments stay intact.

## License

This repository is released under the [MIT License](./LICENSE).
