# aws-cognito-user-pool

Terraform module to build and manage a Cognito user pool.

## Usage

### With custom domain for user pool

```hcl-terraform
module "cognito_user_pool" {
  source = "git::https://gitlab.com/open-source-devex/terraform-modules/aws/cognito-user-pool.git?ref=v3.0.0"

  project     = "my-project"
  environment = "my-environment"

  configure_custom_domain = true

  user_pool_custom_domain_name            = "example.com"
  user_pool_custom_domain_certificate_arn = "${var.certificate_arn}"
  user_pool_custom_domain_route53_zone_id = "${var.route53_zone_id}"

  default_user_pool_client_callback_urls = ["https://wwww.exmaple.com/login"]
  default_user_pool_client_logout_urls   = ["https://wwww.example.com/logout"]
}
```

### Without custom domain for user pool

```hcl-terraform
module "cognito_user_pool" {
  source = "git::https://gitlab.com/open-source-devex/terraform-modules/aws/cognito-user-pool.git?ref=v3.0.0"

  project     = "my-project"
  environment = "my-environment"

  configure_custom_domain = false

  default_user_pool_client_callback_urls = ["https://wwww.exmaple.com/login"]
  default_user_pool_client_logout_urls   = ["https://wwww.example.com/logout"]
}
```

## Docs

<!-- BEGINNING OF PRE-COMMIT-OPENTOFU DOCS HOOK -->
## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_aws"></a> [aws](#requirement\_aws) | >= 6.0.0 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_aws"></a> [aws](#provider\_aws) | 6.15.0 |

## Modules

No modules.

## Resources

| Name | Type |
|------|------|
| [aws_cognito_identity_provider.user_pool_idp](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cognito_identity_provider) | resource |
| [aws_cognito_user_group.groups](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cognito_user_group) | resource |
| [aws_cognito_user_pool.default](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cognito_user_pool) | resource |
| [aws_cognito_user_pool_client.ignore_changes_to_callback_urls](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cognito_user_pool_client) | resource |
| [aws_cognito_user_pool_client.strict](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cognito_user_pool_client) | resource |
| [aws_cognito_user_pool_domain.custom_domain](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cognito_user_pool_domain) | resource |
| [aws_cognito_user_pool_domain.default_domain](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cognito_user_pool_domain) | resource |
| [aws_route53_record.cognito_domain_alias_target_subdomain](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/route53_record) | resource |
| [aws_route53_record.cognito_domain_alias_target_subdomain_ipv6](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/route53_record) | resource |
| [aws_region.current](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/region) | data source |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_challenge_required_on_new_device"></a> [challenge\_required\_on\_new\_device](#input\_challenge\_required\_on\_new\_device) | Whether a challenge is required on a new device. Only applicable to a new device. | `bool` | `true` | no |
| <a name="input_cloudfront_distribution_dnz_zone_id"></a> [cloudfront\_distribution\_dnz\_zone\_id](#input\_cloudfront\_distribution\_dnz\_zone\_id) | The id of the Route53 zone used by AWS for CloudFront. This is typically constant, unless things change on AWS' side. | `string` | `"Z2FDTNDATAQYW2"` | no |
| <a name="input_configure_custom_domain"></a> [configure\_custom\_domain](#input\_configure\_custom\_domain) | Whether to configure a custom domain name, or use the default generated by the module. | `bool` | `false` | no |
| <a name="input_default_user_pool_schema"></a> [default\_user\_pool\_schema](#input\_default\_user\_pool\_schema) | Whether to use the default Cognito user pool schema, or the schema defined in `var.user_pool_schema`. | `bool` | `false` | no |
| <a name="input_environment"></a> [environment](#input\_environment) | The environment name. Used for naming resources and domains. | `string` | n/a | yes |
| <a name="input_project"></a> [project](#input\_project) | The project name. Used for naming resources and domains. | `string` | n/a | yes |
| <a name="input_remember_device"></a> [remember\_device](#input\_remember\_device) | Should the user pool store information about user devices. Options: always, user-opt-in, never | `string` | `"always"` | no |
| <a name="input_user_pool_account_recovery_mechanisms"></a> [user\_pool\_account\_recovery\_mechanisms](#input\_user\_pool\_account\_recovery\_mechanisms) | Options for account recovery, in order of priority (first has more priority) | `list(string)` | <pre>[<br/>  "admin_only"<br/>]</pre> | no |
| <a name="input_user_pool_alias_attributes"></a> [user\_pool\_alias\_attributes](#input\_user\_pool\_alias\_attributes) | The user pool attributes supported as alias. Conflicts with `var.user_pool_username_attributes`. Options: phone\_number, email, or preferred\_username. | `list(string)` | <pre>[<br/>  "email"<br/>]</pre> | no |
| <a name="input_user_pool_auto_verified_attributes"></a> [user\_pool\_auto\_verified\_attributes](#input\_user\_pool\_auto\_verified\_attributes) | The user pool attributes that are auto verified. | `list(string)` | <pre>[<br/>  "email"<br/>]</pre> | no |
| <a name="input_user_pool_clients"></a> [user\_pool\_clients](#input\_user\_pool\_clients) | A list of objects describing the clients | <pre>map(object({<br/>    name                            = string<br/>    generate_secret                 = bool<br/>    allow_oauth_flows               = bool<br/>    callback_urls                   = list(string)<br/>    callback_domains                = list(string)<br/>    logout_urls                     = list(string)<br/>    allowed_oauth_flows             = list(string)<br/>    allowed_oauth_scopes            = list(string)<br/>    explicit_auth_flows             = list(string)<br/>    identity_providers              = list(string)<br/>    write_attributes                = list(string)<br/>    ignore_changes_to_callback_urls = optional(bool)<br/>    enable_token_revocation         = optional(bool)<br/>    prevent_user_existence_errors   = optional(string)<br/>    auth_session_validity           = optional(number)<br/>    token_validity_units = optional(object({<br/>      access_token  = string<br/>      id_token      = string<br/>      refresh_token = string<br/>    }))<br/>  }))</pre> | <pre>{<br/>  "client1": {<br/>    "allow_oauth_flows": true,<br/>    "allowed_oauth_flows": [<br/>      "code"<br/>    ],<br/>    "allowed_oauth_scopes": [<br/>      "openid",<br/>      "email"<br/>    ],<br/>    "callback_domains": [],<br/>    "callback_urls": [],<br/>    "explicit_auth_flows": [<br/>      "ADMIN_NO_SRP_AUTH"<br/>    ],<br/>    "generate_secret": true,<br/>    "identity_providers": [<br/>      "COGNITO"<br/>    ],<br/>    "logout_urls": [],<br/>    "name": "default-client",<br/>    "write_attributes": [<br/>      "name",<br/>      "email"<br/>    ]<br/>  }<br/>}</pre> | no |
| <a name="input_user_pool_custom_domain_certificate_arn"></a> [user\_pool\_custom\_domain\_certificate\_arn](#input\_user\_pool\_custom\_domain\_certificate\_arn) | The ARN of the certificate for the custom domain. | `string` | `""` | no |
| <a name="input_user_pool_custom_domain_name"></a> [user\_pool\_custom\_domain\_name](#input\_user\_pool\_custom\_domain\_name) | The full (custom) domain name for the user pool. | `string` | `""` | no |
| <a name="input_user_pool_custom_domain_route53_zone_id"></a> [user\_pool\_custom\_domain\_route53\_zone\_id](#input\_user\_pool\_custom\_domain\_route53\_zone\_id) | The id of the Route53 zone for the custom domain. | `string` | `""` | no |
| <a name="input_user_pool_default_domain_name"></a> [user\_pool\_default\_domain\_name](#input\_user\_pool\_default\_domain\_name) | The prefix for the AWS generated domain name for the user pool. | `string` | `""` | no |
| <a name="input_user_pool_groups"></a> [user\_pool\_groups](#input\_user\_pool\_groups) | Groups defined in the user pool. | `map(string)` | `{}` | no |
| <a name="input_user_pool_identity_provider_attribute_mapping"></a> [user\_pool\_identity\_provider\_attribute\_mapping](#input\_user\_pool\_identity\_provider\_attribute\_mapping) | A mapping of idp attributes to user pool attributes. | `map(string)` | `{}` | no |
| <a name="input_user_pool_identity_provider_details"></a> [user\_pool\_identity\_provider\_details](#input\_user\_pool\_identity\_provider\_details) | The configuration for the idp. Should include 'MetadataFile', 'SSORedirectBindingURI', and all other required parameters. | `map(string)` | `{}` | no |
| <a name="input_user_pool_identity_provider_name"></a> [user\_pool\_identity\_provider\_name](#input\_user\_pool\_identity\_provider\_name) | The name for an identity provider. If set this will trigger the creation of the idp. | `string` | `""` | no |
| <a name="input_user_pool_identity_provider_type"></a> [user\_pool\_identity\_provider\_type](#input\_user\_pool\_identity\_provider\_type) | The type of the idp. | `string` | `""` | no |
| <a name="input_user_pool_name"></a> [user\_pool\_name](#input\_user\_pool\_name) | Name for the Cognito user pool. When this input is not supplied, the value defaults to `"${var.project}-${var.environment}"`. | `string` | `""` | no |
| <a name="input_user_pool_password_min_length"></a> [user\_pool\_password\_min\_length](#input\_user\_pool\_password\_min\_length) | Minimum password length. | `number` | `60` | no |
| <a name="input_user_pool_password_req_lowercase"></a> [user\_pool\_password\_req\_lowercase](#input\_user\_pool\_password\_req\_lowercase) | Passwords require lowercase characters. | `bool` | `true` | no |
| <a name="input_user_pool_password_req_numbers"></a> [user\_pool\_password\_req\_numbers](#input\_user\_pool\_password\_req\_numbers) | Passwords require number characters. | `bool` | `true` | no |
| <a name="input_user_pool_password_req_symbols"></a> [user\_pool\_password\_req\_symbols](#input\_user\_pool\_password\_req\_symbols) | Passwords require symbol characters. | `bool` | `true` | no |
| <a name="input_user_pool_password_req_uppercase"></a> [user\_pool\_password\_req\_uppercase](#input\_user\_pool\_password\_req\_uppercase) | Passwords require uppercase characters. | `bool` | `true` | no |
| <a name="input_user_pool_schema"></a> [user\_pool\_schema](#input\_user\_pool\_schema) | Schema attributes of the user pool. Custom attributes can be defined here as well. This variable is a map, to prevent terraform from trying to recreate all values when the list changes. | <pre>map(object({<br/>    attribute_data_type      = string<br/>    name                     = string<br/>    mutable                  = optional(bool)<br/>    required                 = optional(bool)<br/>    developer_only_attribute = optional(bool)<br/>    number_attribute_constraints = optional(object({<br/>      max_value = number<br/>      min_value = number<br/>    }))<br/>    string_attribute_constraints = optional(object({<br/>      max_length = number<br/>      min_length = number<br/>    }))<br/>  }))</pre> | <pre>{<br/>  "email": {<br/>    "attribute_data_type": "String",<br/>    "mutable": true,<br/>    "name": "email",<br/>    "required": true,<br/>    "string_attribute_constraints": {<br/>      "max_length": 256,<br/>      "min_length": 5<br/>    }<br/>  },<br/>  "username": {<br/>    "attribute_data_type": "String",<br/>    "mutable": true,<br/>    "name": "name",<br/>    "required": true,<br/>    "string_attribute_constraints": {<br/>      "max_length": 50,<br/>      "min_length": 5<br/>    }<br/>  }<br/>}</pre> | no |
| <a name="input_user_pool_temporary_password_validity_days"></a> [user\_pool\_temporary\_password\_validity\_days](#input\_user\_pool\_temporary\_password\_validity\_days) | Days until a temporary password becomes invalid. | `number` | `7` | no |
| <a name="input_user_pool_username_attributes"></a> [user\_pool\_username\_attributes](#input\_user\_pool\_username\_attributes) | The user pool attributes used for identifying users when a user signs up. Conflicts with `var.alias_attributes`. | `list(string)` | `[]` | no |
| <a name="input_username_case_sensitive"></a> [username\_case\_sensitive](#input\_username\_case\_sensitive) | Whether to make the username case sensitive | `bool` | `null` | no |
| <a name="input_verification_message_template"></a> [verification\_message\_template](#input\_verification\_message\_template) | Configure a message to send to users when they need to verify their account. | <pre>object({<br/>    default_email_option  = optional(string)<br/>    email_message         = optional(string)<br/>    email_message_by_link = optional(string)<br/>    email_subject         = optional(string)<br/>    email_subject_by_link = optional(string)<br/>    sms_message           = optional(string)<br/>  })</pre> | `null` | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_user_pool_arn"></a> [user\_pool\_arn](#output\_user\_pool\_arn) | n/a |
| <a name="output_user_pool_client_secrets"></a> [user\_pool\_client\_secrets](#output\_user\_pool\_client\_secrets) | n/a |
| <a name="output_user_pool_clients"></a> [user\_pool\_clients](#output\_user\_pool\_clients) | n/a |
| <a name="output_user_pool_domain_name"></a> [user\_pool\_domain\_name](#output\_user\_pool\_domain\_name) | n/a |
| <a name="output_user_pool_endpoint"></a> [user\_pool\_endpoint](#output\_user\_pool\_endpoint) | n/a |
| <a name="output_user_pool_id"></a> [user\_pool\_id](#output\_user\_pool\_id) | n/a |
<!-- END OF PRE-COMMIT-OPENTOFU DOCS HOOK -->
